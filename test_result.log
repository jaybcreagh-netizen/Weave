
> weavenative@1.0.0 test
> jest

PASS src/modules/relationships/services/__tests__/friend.service.test.ts
PASS src/modules/intelligence/__tests__/scoring.service.test.ts
PASS src/modules/intelligence/__tests__/decay.service.test.ts
PASS src/modules/intelligence/__tests__/scoring-enhancements.test.ts
PASS src/modules/interactions/services/__tests__/plan.service.test.ts
PASS src/modules/intelligence/__tests__/momentum.service.test.ts
FAIL src/modules/relationships/services/__tests__/image.service.test.ts
  ● Test suite failed to run

    TypeError: Cannot read properties of undefined (reading 'constants')

    > 1 | import * as Sentry from '@sentry/react-native';
        | ^
      2 |
      3 | /**
      4 |  * Logger utility for handling logs in different environments.

      at Object.constants (node_modules/@sentry/react-native/src/js/utils/rnlibraries.ts:34:23)
      at Object.require (node_modules/@sentry/react-native/src/js/integrations/debugsymbolicatorutils.ts:4:1)
      at Object.require (node_modules/@sentry/react-native/src/js/integrations/debugsymbolicator.ts:7:1)
      at Object.require (node_modules/@sentry/react-native/src/js/integrations/exports.ts:1:1)
      at Object.require (node_modules/@sentry/react-native/src/js/index.ts:59:1)
      at Object.require (src/shared/utils/Logger.ts:1:1)
      at Object.require (src/modules/relationships/services/image.service.ts:19:1)
      at Object.require (src/modules/relationships/services/__tests__/image.service.test.ts:2:1)

PASS src/modules/intelligence/__tests__/resilience.service.test.ts
PASS src/modules/interactions/services/__tests__/suggestion-tracker.service.test.ts
PASS src/modules/interactions/services/__tests__/suggestion-storage.service.test.ts
PASS src/modules/relationships/services/__tests__/lifecycle.service.test.ts
PASS src/modules/auth/services/__tests__/sync-engine.test.ts (5.354 s)
  ● Console

    console.error
      [ERROR] Failed to load last sync timestamp: Error: Storage error
          at Object.<anonymous> (/app/src/modules/auth/services/__tests__/sync-engine.test.ts:53:67)
          at Generator.next (<anonymous>)
          at asyncGeneratorStep (/app/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
          at _next (/app/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
          at /app/node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
          at new Promise (<anonymous>)
          at Object.<anonymous> (/app/node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
          at Promise.then.completed (/app/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/app/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/app/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/app/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/app/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/app/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/app/node_modules/jest-circus/build/run.js:121:9)
          at run (/app/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/app/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/app/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/app/node_modules/jest-runner/build/testWorker.js:106:12)

      57 |     static error(message: string, error?: any, ...args: any[]): void {
      58 |         if (__DEV__) {
    > 59 |             console.error(`[ERROR] ${message}`, error, ...args);
         |                          ^
      60 |         } else {
      61 |             // In production, send to Sentry
      62 |             if (error instanceof Error) {

      at Function.apply (src/shared/utils/Logger.ts:59:26)
      at SyncEngine.error (src/modules/auth/services/sync-engine.ts:344:14)
          at Generator.throw (<anonymous>)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _throw (node_modules/@babel/runtime/helpers/asyncToGenerator.js:20:9)

    console.error
      [ERROR] Failed to save last sync timestamp: Error: Storage error
          at Object.<anonymous> (/app/src/modules/auth/services/__tests__/sync-engine.test.ts:75:67)
          at Generator.next (<anonymous>)
          at asyncGeneratorStep (/app/node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
          at _next (/app/node_modules/@babel/runtime/helpers/asyncToGenerator.js:17:9)
          at /app/node_modules/@babel/runtime/helpers/asyncToGenerator.js:22:7
          at new Promise (<anonymous>)
          at Object.<anonymous> (/app/node_modules/@babel/runtime/helpers/asyncToGenerator.js:14:12)
          at Promise.then.completed (/app/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/app/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/app/node_modules/jest-circus/build/run.js:316:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/app/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/app/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/app/node_modules/jest-circus/build/run.js:121:9)
          at _runTestsForDescribeBlock (/app/node_modules/jest-circus/build/run.js:121:9)
          at run (/app/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/app/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/app/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/app/node_modules/jest-runner/build/testWorker.js:106:12)

      57 |     static error(message: string, error?: any, ...args: any[]): void {
      58 |         if (__DEV__) {
    > 59 |             console.error(`[ERROR] ${message}`, error, ...args);
         |                          ^
      60 |         } else {
      61 |             // In production, send to Sentry
      62 |             if (error instanceof Error) {

      at Function.apply (src/shared/utils/Logger.ts:59:26)
      at SyncEngine.error (src/modules/auth/services/sync-engine.ts:357:14)
          at Generator.throw (<anonymous>)
      at asyncGeneratorStep (node_modules/@babel/runtime/helpers/asyncToGenerator.js:3:17)
      at _throw (node_modules/@babel/runtime/helpers/asyncToGenerator.js:20:9)

PASS src/modules/interactions/services/__tests__/weave-logging.service.test.ts (46.38 s)
  ● Console

    console.warn
      Missing Supabase environment variables. Cloud sync will be disabled.
      Add EXPO_PUBLIC_SUPABASE_URL and EXPO_PUBLIC_SUPABASE_ANON_KEY to .env

      60 | export const supabase = (() => {
      61 |   if (!supabaseUrl || !supabaseAnonKey) {
    > 62 |     console.warn(
         |             ^
      63 |       'Missing Supabase environment variables. Cloud sync will be disabled.\n' +
      64 |       'Add EXPO_PUBLIC_SUPABASE_URL and EXPO_PUBLIC_SUPABASE_ANON_KEY to .env'
      65 |     );

      at warn (src/modules/auth/services/supabase.service.ts:62:13)
      at Object.<anonymous> (src/modules/auth/services/supabase.service.ts:103:2)
      at Object.require (src/modules/auth/store/auth.store.ts:7:1)
      at Object.require (src/modules/auth/index.ts:7:1)
      at Object.require (src/modules/reflection/services/oracle/oracle-service.ts:2:1)
      at Object.require (src/modules/reflection/index.ts:23:1)
      at Object.require (src/modules/interactions/services/event-scanner.ts:5:1)
      at Object.require (src/modules/interactions/index.ts:20:1)
      at Object.require (src/modules/insights/hooks/usePortfolio.ts:13:1)
      at Object.require (src/modules/insights/index.ts:24:1)
      at Object.require (src/modules/interactions/services/weave-logging.service.ts:15:1)
      at Object.require (src/modules/interactions/services/__tests__/weave-logging.service.test.ts:2:1)

    console.warn
      expo-notifications: Push notifications (remote notifications) functionality provided by expo-notifications will be removed from Expo Go in SDK 53. Instead, use a development build. Read more at https://docs.expo.dev/develop/development-builds/introduction/.

       9 |  */
      10 |
    > 11 | import * as Notifications from 'expo-notifications';
         | ^
      12 | import AsyncStorage from '@react-native-async-storage/async-storage';
      13 | import { database } from '@/db';
      14 | import UserProfile from '@/db/models/UserProfile';

      at warn (node_modules/expo-notifications/src/warnOfExpoGoPushUsage.ts:8:13)
      at addPushTokenListener (node_modules/expo-notifications/src/TokenEmitter.ts:45:24)
      at Object.<anonymous> (node_modules/expo-notifications/src/DevicePushTokenAutoRegistration.fx.ts:86:23)
      at Object.require (node_modules/expo-notifications/src/getExpoPushTokenAsync.ts:5:1)
      at Object.require (node_modules/expo-notifications/src/index.ts:16:1)
      at Object.require (src/modules/notifications/services/notification-manager-enhanced.ts:11:1)
      at Object.require (src/modules/notifications/index.ts:1:1)
      at Object.require (src/modules/auth/services/background-event-sync.ts:8:1)
      at Object.require (src/modules/auth/store/sync.store.ts:2:1)
      at Object.require (src/modules/auth/index.ts:9:1)
      at Object.require (src/modules/reflection/services/oracle/oracle-service.ts:2:1)
      at Object.require (src/modules/reflection/index.ts:23:1)
      at Object.require (src/modules/interactions/services/event-scanner.ts:5:1)
      at Object.require (src/modules/interactions/index.ts:20:1)
      at Object.require (src/modules/insights/hooks/usePortfolio.ts:13:1)
      at Object.require (src/modules/insights/index.ts:24:1)
      at Object.require (src/modules/interactions/services/weave-logging.service.ts:15:1)
      at Object.require (src/modules/interactions/services/__tests__/weave-logging.service.test.ts:2:1)


Test Suites: 1 failed, 12 passed, 13 total
Tests:       69 passed, 69 total
Snapshots:   0 total
Time:        47.441 s
Ran all test suites.
