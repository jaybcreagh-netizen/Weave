# Google Sign-In Setup Guide

This guide walks you through obtaining the necessary Google Client IDs and configuring Supabase for Google Authentication.

## Prerequisites
- A Google Cloud Platform (GCP) Account
- Access to your Supabase Project Dashboard

---

## Part 1: Google Cloud Console Setup

1.  **Create a Project**
    *   Go to [Google Cloud Console](https://console.cloud.google.com/).
    *   Click the project dropdown (top left) > **New Project**.
    *   Name it `Weave` (or similar) and click **Create**.

2.  **Configure OAuth Consent Screen**
    *   In the side menu, go to **APIs & Services** > **OAuth consent screen**.
    *   Select **External** (unless you are a Google Workspace org).
    *   Fill in required fields:
        *   **App Name**: Weave
        *   **Support Email**: Your email
        *   **Developer Contact Info**: Your email
    *   Click **Save and Continue** through the steps (you can skip "Scopes" and "Test Users" for now, or add yourself as a test user).

3.  **Create Credentials**
    Go to **APIs & Services** > **Credentials**. You need to create **2 separate Client IDs**:

    ### A. Web Client ID (For Supabase)
    *   Click **Create Credentials** > **OAuth client ID**.
    *   Application type: **Web application**.
    *   Name: `Supabase Auth` (or similar).
    *   **Authorized JavaScript origins**: `https://<your-project-ref>.supabase.co` (Find this in Supabase > Settings > API).
    *   **Authorized redirect URIs**: `https://<your-project-ref>.supabase.co/auth/v1/callback`.
    *   Click **Create**.
    *   **COPY** the `Client ID`. This is your `GOOGLE_WEB_CLIENT_ID`.

    ### B. iOS Client ID (For the App)
    *   Click **Create Credentials** > **OAuth client ID**.
    *   Application type: **iOS**.
    *   Name: `Weave iOS`.
    *   **Bundle ID**: `com.jaycreagh.WeaveNative` (or whatever is in your `app.json`).
    *   Click **Create**.
    *   **COPY** the `Client ID`. This is your `GOOGLE_IOS_CLIENT_ID`.
    *   *(Note: You do NOT need to download the plist file for the new library version, just the ID is enough).*

---

## Part 2: Supabase Configuration

1.  Go to your **Supabase Dashboard** > **Authentication** > **Providers**.
2.  Select **Google**.
3.  **Enable** Google.
4.  Paste the **Web Client ID** (from Step 3A) into the `Client ID` field.
5.  Paste the **Web Client Secret** (also from Step 3A) into the `Client Secret` field.
6.  Under **Authorized Client IDs (for iOS/Android)**, paste your **iOS Client ID** (from Step 3B).
    *   *Crucial Step: This tells Supabase to accept tokens generated by your iOS app.*
7.  Click **Save**.

---

## Part 3: URL Scheme (iOS)

To allow the app to return from the browser/Google app after sign-in, you need a URL scheme.

1.  Open your **iOS Client ID** in Google Cloud Console.
2.  Look for the **iOS URL scheme**. It usually looks like the generic reverse DNS of your client ID (e.g., `com.googleusercontent.apps.123456789...`).
3.  Add this to your `app.json` under `expo.ios.infoPlist.CFBundleURLTypes`:

```json
"ios": {
  "bundleIdentifier": "com.jaycreagh.WeaveNative",
  "infoPlist": {
    "CFBundleURLTypes": [
      {
        "CFBundleURLSchemes": [
          "com.googleusercontent.apps.YOUR-IOS-CLIENT-ID-REVERSED"
        ]
      }
    ]
  }
}
```
*(Note: Since we are using Expo, `google-signin` config plugin might handle this if properly configured, but manual addition ensures safety).*

---

## Part 4: Environment Variables

Add these to your `.env` file (or `eas.json` for build):

```bash
EXPO_PUBLIC_GOOGLE_WEB_CLIENT_ID="<your-web-client-id>.apps.googleusercontent.com"
EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID="<your-ios-client-id>.apps.googleusercontent.com"
```

The code in `supabase-auth.service.ts` already looks for these variables.
